# Sample Data & Testing Guide\n\n## Quick Start\n\n### Step 1: Get Your User ID\n\nRun this query first:\n\n```sql\nSELECT auth.uid() as current_user_id;\n```\n\n**Result**: You'll get a UUID like `550e8400-e29b-41d4-a716-446655440000`\n\n**Save this** - you'll need it for testing.\n\n---\n\n### Step 2: Create Sample Data\n\nRun the entire `SUPABASE_SAMPLE_DATA_AND_TESTING.sql` script.\n\nThis will create 5 sample transactions:\n- ✅ DRAFT-001 (draft status)\n- ✅ SUBMITTED-001 (submitted status)\n- ✅ APPROVED-001 (approved status)\n- ✅ REJECTED-001 (rejected status)\n- ✅ REVISION-001 (revision_requested status)\n\n**Result**: You'll see the transaction IDs created.\n\n---\n\n### Step 3: Verify Sample Data Created\n\nRun this verification query:\n\n```sql\nSELECT \n  id,\n  entry_number,\n  approval_status,\n  created_at\nFROM transactions \nWHERE entry_number LIKE '%DRAFT%' \n   OR entry_number LIKE '%SUBMITTED%'\n   OR entry_number LIKE '%APPROVED%'\n   OR entry_number LIKE '%REJECTED%'\n   OR entry_number LIKE '%REVISION%'\nORDER BY created_at DESC;\n```\n\n**Expected Result**:\n```\nid                                   | entry_number    | approval_status      | created_at\n550e8400-e29b-41d4-a716-446655440000 | DRAFT-001       | draft                | 2024-12-01 10:00:00\n550e8400-e29b-41d4-a716-446655440001 | SUBMITTED-001   | submitted            | 2024-12-01 10:00:00\n550e8400-e29b-41d4-a716-446655440002 | APPROVED-001    | approved             | 2024-12-01 10:00:00\n550e8400-e29b-41d4-a716-446655440003 | REJECTED-001    | rejected             | 2024-12-01 10:00:00\n550e8400-e29b-41d4-a716-446655440004 | REVISION-001    | revision_requested   | 2024-12-01 10:00:00\n```\n\n---\n\n## Testing Workflows\n\n### Test 1: Submit Draft for Approval\n\n**Query**:\n```sql\nSELECT submit_transaction_for_approval(\n  (SELECT id FROM transactions WHERE entry_number = 'DRAFT-001' LIMIT 1),\n  auth.uid()\n);\n```\n\n**Expected Result**:\n```json\n{\"success\": true, \"message\": \"Transaction submitted for approval\"}\n```\n\n**Verify**:\n```sql\nSELECT id, entry_number, approval_status, submitted_at, submitted_by \nFROM transactions \nWHERE entry_number = 'DRAFT-001';\n```\n\n**Expected**: Status should be `submitted`\n\n---\n\n### Test 2: Approve Transaction\n\n**Query**:\n```sql\nSELECT approve_transaction(\n  (SELECT id FROM transactions WHERE entry_number = 'SUBMITTED-001' LIMIT 1),\n  auth.uid(),\n  'Looks good, approved'\n);\n```\n\n**Expected Result**:\n```json\n{\"success\": true, \"message\": \"Transaction approved\"}\n```\n\n**Verify**:\n```sql\nSELECT id, entry_number, approval_status, approved_at, approved_by \nFROM transactions \nWHERE entry_number = 'SUBMITTED-001';\n```\n\n**Expected**: Status should be `approved`\n\n---\n\n### Test 3: Request Edit\n\n**Query**:\n```sql\nSELECT request_edit_for_transaction(\n  (SELECT id FROM transactions WHERE entry_number = 'APPROVED-001' LIMIT 1),\n  auth.uid(),\n  'Need to fix the description and amount'\n);\n```\n\n**Expected Result**:\n```json\n{\"success\": true, \"message\": \"Edit request created\"}\n```\n\n**Verify**:\n```sql\nSELECT id, transaction_id, reason, status, requested_at \nFROM edit_requests \nWHERE transaction_id = (SELECT id FROM transactions WHERE entry_number = 'APPROVED-001' LIMIT 1);\n```\n\n**Expected**: One edit request with status `pending`\n\n---\n\n### Test 4: Approve Edit Request\n\n**Query**:\n```sql\nSELECT approve_edit_request(\n  (SELECT id FROM edit_requests WHERE transaction_id = (SELECT id FROM transactions WHERE entry_number = 'APPROVED-001' LIMIT 1) LIMIT 1),\n  auth.uid(),\n  'Approved for editing'\n);\n```\n\n**Expected Result**:\n```json\n{\"success\": true, \"message\": \"Edit request approved\"}\n```\n\n**Verify**:\n```sql\nSELECT id, entry_number, approval_status, edit_locked \nFROM transactions \nWHERE entry_number = 'APPROVED-001';\n```\n\n**Expected**: Status should be `revision_requested`, edit_locked should be `false`\n\n---\n\n### Test 5: Resubmit Transaction\n\n**Query**:\n```sql\nSELECT resubmit_transaction(\n  (SELECT id FROM transactions WHERE entry_number = 'REJECTED-001' LIMIT 1),\n  auth.uid(),\n  'Fixed the amount as requested'\n);\n```\n\n**Expected Result**:\n```json\n{\"success\": true, \"message\": \"Transaction resubmitted\"}\n```\n\n**Verify**:\n```sql\nSELECT id, entry_number, approval_status, submitted_at \nFROM transactions \nWHERE entry_number = 'REJECTED-001';\n```\n\n**Expected**: Status should be `submitted`\n\n**Verify Resubmission Record**:\n```sql\nSELECT id, transaction_id, previous_status, reason, resubmitted_at \nFROM resubmissions \nWHERE transaction_id = (SELECT id FROM transactions WHERE entry_number = 'REJECTED-001' LIMIT 1);\n```\n\n**Expected**: One resubmission record with previous_status `rejected`\n\n---\n\n## View Audit Trail\n\n### View All Changes for a Transaction\n\n```sql\nSELECT \n  id,\n  action,\n  actor_id,\n  actor_name,\n  changes,\n  created_at\nFROM transaction_audit_log\nWHERE transaction_id = (SELECT id FROM transactions WHERE entry_number = 'DRAFT-001' LIMIT 1)\nORDER BY created_at DESC;\n```\n\n**Expected**: Multiple audit log entries showing all actions (submit, approve, etc.)\n\n---\n\n## Complete Status Report\n\n### Get Full Status for All Sample Transactions\n\n```sql\nSELECT \n  t.id,\n  t.entry_number,\n  t.approval_status,\n  t.is_posted,\n  t.created_at,\n  t.submitted_at,\n  t.approved_at,\n  t.rejected_at,\n  t.rejection_reason,\n  COUNT(DISTINCT er.id) as pending_edit_requests,\n  COUNT(DISTINCT r.id) as resubmission_count,\n  COUNT(DISTINCT al.id) as audit_log_entries\nFROM transactions t\nLEFT JOIN edit_requests er ON t.id = er.transaction_id AND er.status = 'pending'\nLEFT JOIN resubmissions r ON t.id = r.transaction_id\nLEFT JOIN transaction_audit_log al ON t.id = al.transaction_id\nWHERE t.entry_number LIKE '%DRAFT%' \n   OR t.entry_number LIKE '%SUBMITTED%'\n   OR t.entry_number LIKE '%APPROVED%'\n   OR t.entry_number LIKE '%REJECTED%'\n   OR t.entry_number LIKE '%REVISION%'\nGROUP BY t.id\nORDER BY t.created_at DESC;\n```\n\n**Expected**: Complete overview of all sample transactions with their status and related records\n\n---\n\n## Summary Statistics\n\n```sql\nSELECT \n  'Total Sample Transactions' as metric,\n  COUNT(*) as value\nFROM transactions \nWHERE entry_number LIKE '%DRAFT%' \n   OR entry_number LIKE '%SUBMITTED%'\n   OR entry_number LIKE '%APPROVED%'\n   OR entry_number LIKE '%REJECTED%'\n   OR entry_number LIKE '%REVISION%'\n\nUNION ALL\n\nSELECT \n  'Total Edit Requests',\n  COUNT(*)\nFROM edit_requests\n\nUNION ALL\n\nSELECT \n  'Total Resubmissions',\n  COUNT(*)\nFROM resubmissions\n\nUNION ALL\n\nSELECT \n  'Total Audit Log Entries',\n  COUNT(*)\nFROM transaction_audit_log;\n```\n\n**Expected**: Summary of all records created\n\n---\n\n## Troubleshooting\n\n### Issue: \"No rows returned\" when querying sample data\n\n**Solution**: Make sure you ran the sample data creation script first\n\n### Issue: \"Permission denied\" error\n\n**Solution**: Check that RLS policies are enabled and you're logged in\n\n### Issue: Function returns error\n\n**Solution**: Make sure you ran the main SQL script first to create the functions\n\n---\n\n## Cleanup\n\nTo delete all sample data:\n\n```sql\nDELETE FROM transaction_audit_log \nWHERE transaction_id IN (\n  SELECT id FROM transactions \n  WHERE entry_number LIKE '%DRAFT%' \n     OR entry_number LIKE '%SUBMITTED%'\n     OR entry_number LIKE '%APPROVED%'\n     OR entry_number LIKE '%REJECTED%'\n     OR entry_number LIKE '%REVISION%'\n);\n\nDELETE FROM edit_requests \nWHERE transaction_id IN (\n  SELECT id FROM transactions \n  WHERE entry_number LIKE '%DRAFT%' \n     OR entry_number LIKE '%SUBMITTED%'\n     OR entry_number LIKE '%APPROVED%'\n     OR entry_number LIKE '%REJECTED%'\n     OR entry_number LIKE '%REVISION%'\n);\n\nDELETE FROM resubmissions \nWHERE transaction_id IN (\n  SELECT id FROM transactions \n  WHERE entry_number LIKE '%DRAFT%' \n     OR entry_number LIKE '%SUBMITTED%'\n     OR entry_number LIKE '%APPROVED%'\n     OR entry_number LIKE '%REJECTED%'\n     OR entry_number LIKE '%REVISION%'\n);\n\nDELETE FROM transactions \nWHERE entry_number LIKE '%DRAFT%' \n   OR entry_number LIKE '%SUBMITTED%'\n   OR entry_number LIKE '%APPROVED%'\n   OR entry_number LIKE '%REJECTED%'\n   OR entry_number LIKE '%REVISION%';\n```\n\n---\n\n## Testing Checklist\n\n- [ ] Created sample data\n- [ ] Verified 5 transactions created\n- [ ] Tested submit for approval\n- [ ] Tested approve transaction\n- [ ] Tested request edit\n- [ ] Tested approve edit request\n- [ ] Tested resubmit transaction\n- [ ] Viewed audit trail\n- [ ] Viewed complete status report\n- [ ] All tests passed\n\n---\n\n**Status**: ✅ Ready for testing\n"} 
