# Transaction Edit System - Integration Guide\n\n## Quick Start: Adding Edit Workflows to Transactions Page\n\n### Step 1: Import Services\n\n```typescript\n// At the top of src/pages/Transactions/Transactions.tsx\n\nimport {\n  canEditTransaction,\n  canRequestEdit,\n  canResubmit,\n  canApproveTransaction,\n  canRejectTransaction,\n  getAvailableActions,\n  isTransactionLocked,\n  getLockReason\n} from '../../services/transactionPermissions'\n\nimport {\n  requestEdit,\n  getTransactionEditRequests,\n  getPendingEditRequests,\n  approveEditRequest,\n  rejectEditRequest\n} from '../../services/editRequests'\n\nimport {\n  resubmitTransaction,\n  getTransactionResubmissions\n} from '../../services/resubmissions'\n\nimport RequestEditModal from '../../components/Transactions/RequestEditModal'\nimport ResubmitModal from '../../components/Transactions/ResubmitModal'\nimport TransactionStatusBadge from '../../components/Transactions/TransactionStatusBadge'\n```\n\n### Step 2: Add State Variables\n\n```typescript\n// In Transactions component\n\n// Edit request modal state\nconst [requestEditOpen, setRequestEditOpen] = useState(false)\nconst [requestEditTransactionId, setRequestEditTransactionId] = useState<string | null>(null)\n\n// Resubmit modal state\nconst [resubmitOpen, setResubmitOpen] = useState(false)\nconst [resubmitTransactionId, setResubmitTransactionId] = useState<string | null>(null)\nconst [resubmitPreviousStatus, setResubmitPreviousStatus] = useState<string>('')\n```\n\n### Step 3: Add Handler Functions\n\n```typescript\n// Handle request edit\nconst handleRequestEdit = (transaction: TransactionRecord) => {\n  const permission = canRequestEdit(transaction, currentUserId)\n  if (!permission.allowed) {\n    showToast(permission.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©', { severity: 'error' })\n    return\n  }\n  setRequestEditTransactionId(transaction.id)\n  setRequestEditOpen(true)\n}\n\n// Handle resubmit\nconst handleResubmit = (transaction: TransactionRecord) => {\n  const permission = canResubmit(transaction, currentUserId)\n  if (!permission.allowed) {\n    showToast(permission.reason || 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©', { severity: 'error' })\n    return\n  }\n  setResubmitTransactionId(transaction.id)\n  setResubmitPreviousStatus(transaction.approval_status)\n  setResubmitOpen(true)\n}\n\n// Handle approve edit request (for approvers)\nconst handleApproveEditRequest = async (requestId: string) => {\n  try {\n    await approveEditRequest(requestId)\n    showToast('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', { severity: 'success' })\n    await reload()\n  } catch (error: any) {\n    showToast(error?.message || 'ÙØ´Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨', { severity: 'error' })\n  }\n}\n\n// Handle reject edit request (for approvers)\nconst handleRejectEditRequest = async (requestId: string, reason?: string) => {\n  try {\n    await rejectEditRequest(requestId, reason)\n    showToast('ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', { severity: 'success' })\n    await reload()\n  } catch (error: any) {\n    showToast(error?.message || 'ÙØ´Ù„ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', { severity: 'error' })\n  }\n}\n```\n\n### Step 4: Update Action Buttons\n\n```typescript\n// In the table actions column\n\nconst getActionButtons = (transaction: TransactionRecord) => {\n  const actions = getAvailableActions(transaction, currentUserId, userPermissions)\n  \n  return (\n    <Box sx={{ display: 'flex', gap: 1 }}>\n      {actions.includes('edit') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-edit\"\n          onClick={() => handleEdit(transaction)}\n          title=\"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">ØªØ¹Ø¯ÙŠÙ„</span>\n        </button>\n      )}\n      \n      {actions.includes('request_edit') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-info\"\n          onClick={() => handleRequestEdit(transaction)}\n          title=\"Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„</span>\n        </button>\n      )}\n      \n      {actions.includes('resubmit') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-success\"\n          onClick={() => handleResubmit(transaction)}\n          title=\"Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„</span>\n        </button>\n      )}\n      \n      {actions.includes('approve') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-success\"\n          onClick={() => handleApprove(transaction)}\n          title=\"Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">Ù…ÙˆØ§ÙÙ‚Ø©</span>\n        </button>\n      )}\n      \n      {actions.includes('reject') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-danger\"\n          onClick={() => handleReject(transaction)}\n          title=\"Ø±ÙØ¶ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">Ø±ÙØ¶</span>\n        </button>\n      )}\n      \n      {actions.includes('delete') && (\n        <button\n          className=\"ultimate-btn ultimate-btn-danger\"\n          onClick={() => handleDelete(transaction.id)}\n          title=\"Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\"\n        >\n          <span className=\"btn-text\">Ø­Ø°Ù</span>\n        </button>\n      )}\n    </Box>\n  )\n}\n```\n\n### Step 5: Update Status Display\n\n```typescript\n// In the table status column\n\n<Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n  <TransactionStatusBadge\n    status={row.original.approval_status}\n    isPosted={row.original.is_posted}\n    size=\"small\"\n  />\n  \n  {isTransactionLocked(row.original) && (\n    <Tooltip title={getLockReason(row.original)}>\n      <span style={{ fontSize: '14px' }}>ğŸ”’</span>\n    </Tooltip>\n  )}\n</Box>\n```\n\n### Step 6: Add Modals to Render\n\n```typescript\n// At the end of the component render\n\nreturn (\n  <div>\n    {/* Existing content */}\n    \n    {/* Request Edit Modal */}\n    {requestEditTransactionId && (\n      <RequestEditModal\n        open={requestEditOpen}\n        transactionId={requestEditTransactionId}\n        transactionNumber={transactions.find(t => t.id === requestEditTransactionId)?.entry_number}\n        onClose={() => {\n          setRequestEditOpen(false)\n          setRequestEditTransactionId(null)\n        }}\n        onSuccess={() => {\n          showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', { severity: 'success' })\n          reload()\n        }}\n        onError={(error) => showToast(error, { severity: 'error' })}\n      />\n    )}\n    \n    {/* Resubmit Modal */}\n    {resubmitTransactionId && (\n      <ResubmitModal\n        open={resubmitOpen}\n        transactionId={resubmitTransactionId}\n        transactionNumber={transactions.find(t => t.id === resubmitTransactionId)?.entry_number}\n        previousStatus={resubmitPreviousStatus}\n        onClose={() => {\n          setResubmitOpen(false)\n          setResubmitTransactionId(null)\n          setResubmitPreviousStatus('')\n        }}\n        onSuccess={() => {\n          showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', { severity: 'success' })\n          reload()\n        }}\n        onError={(error) => showToast(error, { severity: 'error' })}\n      />\n    )}\n  </div>\n)\n```\n\n---\n\n## Usage Examples\n\n### Example 1: Check if User Can Edit\n\n```typescript\nconst transaction = transactions[0]\nconst permission = canEditTransaction(transaction, currentUserId, userPermissions)\n\nif (permission.allowed) {\n  // Show edit button\n} else {\n  // Show disabled button with tooltip\n  console.log(permission.reason) // \"Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§\"\n}\n```\n\n### Example 2: Get All Available Actions\n\n```typescript\nconst transaction = transactions[0]\nconst actions = getAvailableActions(transaction, currentUserId, userPermissions)\n\nconsole.log(actions)\n// Output: ['edit', 'delete']\n// or: ['request_edit', 'approve', 'reject']\n// or: ['resubmit']\n```\n\n### Example 3: Request Edit for Locked Transaction\n\n```typescript\nconst handleRequestEdit = async (transactionId: string, reason: string) => {\n  try {\n    const request = await requestEdit(transactionId, reason)\n    console.log('Edit request created:', request.id)\n    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„')\n  } catch (error) {\n    showToast('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨')\n  }\n}\n```\n\n### Example 4: Resubmit After Revision\n\n```typescript\nconst handleResubmit = async (transactionId: string) => {\n  try {\n    const resubmission = await resubmitTransaction(transactionId)\n    console.log('Resubmitted:', resubmission.id)\n    showToast('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­')\n  } catch (error) {\n    showToast('ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„')\n  }\n}\n```\n\n### Example 5: Approve Edit Request (Approver)\n\n```typescript\nconst handleApproveEditRequest = async (requestId: string) => {\n  try {\n    await approveEditRequest(requestId, 'ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨')\n    showToast('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„')\n    // Transaction is now unlocked for editing\n  } catch (error) {\n    showToast('ÙØ´Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨')\n  }\n}\n```\n\n---\n\n## Permission Rules Reference\n\n### Edit Transaction\n```\nAllowed if:\n- Transaction is NOT posted\n- Transaction status is 'draft'\n- User is owner OR has 'transactions.manage' permission\n```\n\n### Request Edit\n```\nAllowed if:\n- Transaction is NOT posted\n- Transaction status is NOT 'draft'\n- User is owner\n```\n\n### Resubmit\n```\nAllowed if:\n- Transaction is NOT posted\n- Transaction status is 'revision_requested' OR 'rejected'\n- User is owner\n```\n\n### Approve\n```\nAllowed if:\n- User has 'transactions.approve' permission\n- User is NOT the transaction owner\n- Transaction status is 'submitted' OR 'revision_requested'\n```\n\n### Reject\n```\nAllowed if:\n- User has 'transactions.approve' permission\n- User is NOT the transaction owner\n- Transaction status is 'submitted' OR 'revision_requested'\n```\n\n### Post\n```\nAllowed if:\n- User has 'transactions.post' permission\n- Transaction status is 'approved'\n- Transaction is NOT already posted\n```\n\n### Delete\n```\nAllowed if:\n- Transaction is NOT posted\n- User is owner OR has 'transactions.manage' permission\n```\n\n---\n\n## Error Handling\n\n### Common Errors\n\n```typescript\n// Permission denied\n{\n  allowed: false,\n  reason: 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©',\n  action: 'edit'\n}\n\n// Invalid status\n{\n  allowed: false,\n  reason: 'ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ÙˆØ¯Ø© ÙÙ‚Ø·',\n  action: 'edit'\n}\n\n// Posted transaction\n{\n  allowed: false,\n  reason: 'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§',\n  action: 'edit'\n}\n```\n\n### Handling Errors\n\n```typescript\nconst permission = canEditTransaction(transaction, userId, permissions)\n\nif (!permission.allowed) {\n  // Show user-friendly error message\n  showToast(permission.reason, { severity: 'error' })\n  \n  // Optionally suggest alternative actions\n  if (permission.action === 'edit') {\n    const canRequest = canRequestEdit(transaction, userId)\n    if (canRequest.allowed) {\n      showToast('ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ')\n    }\n  }\n}\n```\n\n---\n\n## Testing Checklist\n\n- [ ] Import all services and components\n- [ ] Add state variables\n- [ ] Implement handler functions\n- [ ] Update action buttons\n- [ ] Update status display\n- [ ] Add modals to render\n- [ ] Test edit workflow\n- [ ] Test request edit workflow\n- [ ] Test resubmit workflow\n- [ ] Test permission checks\n- [ ] Test error handling\n- [ ] Test RTL layout\n- [ ] Test dark theme\n\n---\n\n## Next Steps\n\n1. **Integrate into Transactions page** - Follow steps above\n2. **Add to TransactionWizard** - Show request edit button when locked\n3. **Add to Approvals page** - Show pending edit requests\n4. **Add notifications** - Notify users of edit requests\n5. **Add analytics** - Track edit request metrics\n\n---\n\n**Status**: Ready for integration  \n**Estimated Time**: 2-3 hours  \n**Difficulty**: Medium  \n**Dependencies**: Phase 1 (TransactionWizard) must be complete\n"} 
